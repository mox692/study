%Date%:20210211  
%source%:https://research.swtch.com/hwmm

russ coxのブログから、メモリモデルについて学ぶ.

## はじめに
* シングルスレッド時代では、programを早くするには単純にマシンスペックを上げていくのが常だった
* マルチスレッド(まるちコア)時代に入り、複数のコアでいかに効率を上げていくかがキーとなってきた
* 最適化を施した際に、最適化をしていない状態と比較してprogramの振る舞いが変化しないと言える時にだけ、その最適化が有効だと言える.(最適化を施した際にprogramの振る舞いが変化してしまっては本末転倒). これはシングルスレッドでは比較的に簡単に検証ができる。が、マルチスレッドになると途端にこれが困難になる
* 例えば
```
// Thread 1           // Thread 2
x = 1;                while(done == 0) { /* loop */ }
done = 1;             print(x);
```
この擬似コードにおいて、
* どんな数値がprintされる？
* loopはちゃんと終了する？  

これらの問いに対しての答えは、「状況による」 (x86系では0がprintされ、arm, power系は1が出力されることがある.さらに高級言語からcompileする場合はコンパイラがこれらの命令を変更する場合がある)

## Sequential Consistency
* 逐次一貫性は「それぞれのprocessorが、program自身の命令の順序を変更せずに逐次的に命令を実行する時、そのarchtectureは逐次一貫性がある」と言った風に定義できるだろう
* ```


## x86 Total Store Order (x86-TSO)

## ARM/POWER Relaxed Memory Model